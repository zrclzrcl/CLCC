CREATE TABLE users(id INTEGER PRIMARY KEY, username TEXT NOT NULL UNIQUE, email TEXT NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE posts(id INTEGER PRIMARY KEY, user_id INTEGER, content TEXT, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY(user_id) REFERENCES users(id));
CREATE TABLE comments(id INTEGER PRIMARY KEY, post_id INTEGER, user_id INTEGER, content TEXT, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY(post_id) REFERENCES posts(id), FOREIGN KEY(user_id) REFERENCES users(id));
INSERT INTO users (username, email) VALUES ('user1', 'user1@example.com');
INSERT INTO users (username, email) VALUES ('user2', 'user2@example.com');
INSERT INTO posts(user_id, content) VALUES (1, 'This is a post from user1');
INSERT INTO posts(user_id, content) VALUES (2, 'This is a post from user2');
INSERT INTO comments(post_id, user_id, content) VALUES (1, 2, 'This is a comment from user2 on user1\'s post');
INSERT INTO comments(post_id, user_id, content) VALUES (2, 1, 'This is a comment from user1 on user2\'s post');
CREATE VIEW user_post_counts AS SELECT u.username, COUNT(p.id) AS post_count FROM users u LEFT JOIN posts p ON u.id = p.user_id GROUP BY u.id;
CREATE TRIGGER update_timestamp AFTER UPDATE ON users FOR EACH ROW BEGIN UPDATE users SET created_at = CURRENT_TIMESTAMP WHERE id = OLD.id; END;
PRAGMA foreign_keys=ON;
BEGIN TRANSACTION;
SELECT * FROM user_post_counts;
ROLLBACK;