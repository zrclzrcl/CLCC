CREATE TABLE users(
    id INTEGER PRIMARY KEY,
    username TEXT UNIQUE NOT NULL,
    email TEXT UNIQUE NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO users (username, email) VALUES ('test_user1', 'test1@example.com');
INSERT INTO users (username, email) VALUES ('test_user2', 'test2@example.com');

CREATE INDEX idx_email ON users(email);

ALTER TABLE users ADD COLUMN last_login DATETIME;

UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE username = 'test_user1';

DELETE FROM users WHERE id = 10; -- Testing non-existing record deletion

CREATE TABLE products(
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    price REAL CHECK(price > 0)
);

INSERT INTO products (name, price) VALUES ('Product A', 10.99);
INSERT INTO products (name, price) VALUES ('Product B', 20.00);

ALTER TABLE products ADD COLUMN stock INTEGER DEFAULT 0;

UPDATE products SET stock = 100 WHERE id = 1;

ALTER TABLE products RENAME TO items;

CREATE TRIGGER update_stock AFTER UPDATE ON items FOR EACH ROW
BEGIN
    UPDATE items SET stock = stock - 1 WHERE id = NEW.id AND stock > 0;
END;

-- Testing the trigger by updating the product
UPDATE items SET price = 15.00 WHERE id = 1;