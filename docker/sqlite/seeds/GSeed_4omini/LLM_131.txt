CREATE TABLE users(id INTEGER PRIMARY KEY, name TEXT, age INTEGER);
INSERT INTO users VALUES(1, 'Alice', 30), (2, 'Bob', 25), (3, 'Charlie', 35);

CREATE TABLE orders(order_id INTEGER PRIMARY KEY, user_id INTEGER, amount REAL, order_date TEXT,
                    FOREIGN KEY(user_id) REFERENCES users(id));
INSERT INTO orders VALUES(101, 1, 250.00, '2023-01-01'), 
                         (102, 1, 150.50, '2023-01-05'),
                         (103, 3, 300.75, '2023-01-10');

CREATE VIEW user_summary AS
SELECT u.id, u.name, COUNT(o.order_id) AS order_count, SUM(o.amount) AS total_spent
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
GROUP BY u.id;

SELECT id, name, order_count, total_spent
FROM user_summary
WHERE total_spent > (SELECT AVG(total_spent) FROM user_summary);

CREATE TABLE products(product_id INTEGER PRIMARY KEY, name TEXT, price REAL);
INSERT INTO products VALUES(1, 'Gadget', 99.99), (2, 'Widget', 19.99);

CREATE TABLE order_items(order_item_id INTEGER PRIMARY KEY, order_id INTEGER, product_id INTEGER, 
                         quantity INTEGER, FOREIGN KEY(order_id) REFERENCES orders(order_id), 
                         FOREIGN KEY(product_id) REFERENCES products(product_id));
INSERT INTO order_items VALUES(1, 101, 1, 2), (2, 102, 2, 1), (3, 103, 1, 1);

SELECT o.order_id, SUM(oi.quantity * p.price) AS total_order_value
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
GROUP BY o.order_id
HAVING total_order_value > 100;

CREATE TEMP TABLE temp_data(x INTEGER);
INSERT INTO temp_data VALUES(1), (2), (3), (NULL);

SELECT x, COUNT(*) 
FROM temp_data
GROUP BY x
HAVING x IS NOT NULL;