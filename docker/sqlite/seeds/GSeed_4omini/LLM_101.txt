CREATE TABLE users(id INTEGER PRIMARY KEY, username TEXT COLLATE NOCASE, password TEXT, email TEXT UNIQUE);
INSERT INTO users VALUES(1, 'Alice', 'password123', 'alice@example.com');
INSERT INTO users VALUES(2, 'Bob', 'qwerty', 'bob@example.com');
INSERT INTO users VALUES(3, 'Charlie', '12345', 'CHARLIE@EXAMPLE.COM');
INSERT INTO users VALUES(4, 'Diana', 'letmein', NULL);
INSERT INTO users VALUES(5, 'Eve', 'password', 'eve@example.com');

CREATE TABLE orders(order_id INTEGER PRIMARY KEY, user_id INTEGER, product TEXT, quantity INTEGER, FOREIGN KEY (user_id) REFERENCES users(id));
INSERT INTO orders VALUES(1, 1, 'Laptop', 1);
INSERT INTO orders VALUES(2, 2, 'Smartphone', 2);
INSERT INTO orders VALUES(3, 3, 'Tablet', 1);
INSERT INTO orders VALUES(4, 2, 'Charger', 3);
INSERT INTO orders VALUES(5, 1, 'Mouse', 2);
INSERT INTO orders VALUES(6, NULL, 'Keyboard', 1);  -- Edge case: NULL user_id

CREATE TABLE products(product_id INTEGER PRIMARY KEY, name TEXT, price REAL CHECK(price > 0), stock INTEGER DEFAULT 0);
INSERT INTO products VALUES(1, 'Laptop', 999.99, 10);
INSERT INTO products VALUES(2, 'Smartphone', 499.99, 5);
INSERT INTO products VALUES(3, 'Tablet', 299.99, 0);  -- Edge case: out of stock
INSERT INTO products VALUES(4, 'Charger', 19.99, 50);
INSERT INTO products VALUES(5, 'Mouse', 29.99, 25);

SELECT u.username, o.product, o.quantity FROM users u JOIN orders o ON u.id = o.user_id ORDER BY u.username;
SELECT p.name, COUNT(o.order_id) as order_count FROM products p LEFT JOIN orders o ON p.name = o.product GROUP BY p.name ORDER BY order_count DESC;
SELECT username, email FROM users WHERE email IS NOT NULL UNION SELECT username, email FROM users WHERE email IS NULL ORDER BY username;
INSERT INTO products SELECT 6, 'Headphones', 89.99, 20 WHERE NOT EXISTS (SELECT * FROM products WHERE name = 'Headphones');

-- Testing edge cases with regular and unique constraints
UPDATE products SET stock = stock - 1 WHERE product_id = 1 AND stock > 0;  
UPDATE products SET stock = stock + 1 WHERE product_id = 3;  -- Trying to add stock to an out of stock product

CREATE UNIQUE INDEX idx_username ON users(username COLLATE NOCASE);
CREATE INDEX idx_price ON products(price);