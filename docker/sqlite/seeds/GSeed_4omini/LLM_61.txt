PRAGMA foreign_keys=ON;

CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    username TEXT NOT NULL UNIQUE,
    email TEXT NOT NULL UNIQUE
);

INSERT INTO users (username, email) VALUES ('alice', 'alice@example.com');
INSERT INTO users (username, email) VALUES ('bob', 'bob@example.com');

CREATE TABLE posts (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,
    content TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

INSERT INTO posts (user_id, content) VALUES (1, 'Hello world from Alice!');
INSERT INTO posts (user_id, content) VALUES (1, 'Second post by Alice!');
INSERT INTO posts (user_id, content) VALUES (2, 'This is Bob\'s first post!');

CREATE TABLE comments (
    id INTEGER PRIMARY KEY,
    post_id INTEGER,
    user_id INTEGER,
    content TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

INSERT INTO comments (post_id, user_id, content) VALUES (1, 2, 'Nice post Alice!');
INSERT INTO comments (post_id, user_id, content) VALUES (2, 1, 'Thanks Bob!');
INSERT INTO comments (post_id, user_id, content) VALUES (3, 1, 'I agree Bob!');

SELECT * FROM users;
SELECT u.username, COUNT(p.id) AS post_count FROM users u LEFT JOIN posts p ON u.id = p.user_id GROUP BY u.id;

DELETE FROM comments WHERE id = 1;
DELETE FROM posts WHERE user_id = 1;
DELETE FROM users WHERE username = 'bob';