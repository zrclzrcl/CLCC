CREATE TABLE users(id INTEGER PRIMARY KEY, username TEXT UNIQUE, email TEXT);
CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, price REAL);
CREATE TABLE orders(id INTEGER PRIMARY KEY, user_id INTEGER, product_id INTEGER, quantity INTEGER, FOREIGN KEY(user_id) REFERENCES users(id), FOREIGN KEY(product_id) REFERENCES products(id));
INSERT INTO users(username, email) VALUES('alice', 'alice@example.com');
INSERT INTO users(username, email) VALUES('bob', 'bob@example.com');
INSERT INTO products(name, price) VALUES('Widget', 19.99);
INSERT INTO products(name, price) VALUES('Gadget', 29.99);
INSERT INTO orders(user_id, product_id, quantity) VALUES(1, 1, 2);
INSERT INTO orders(user_id, product_id, quantity) VALUES(2, 2, 3);
INSERT INTO orders(user_id, product_id, quantity) VALUES(1, 2, 1);
SELECT username, COUNT(orders.id) AS order_count FROM users LEFT JOIN orders ON users.id = orders.user_id GROUP BY users.id ORDER BY order_count DESC;
SELECT username, SUM(products.price * orders.quantity) AS total_spent FROM users JOIN orders ON users.id = orders.user_id JOIN products ON orders.product_id = products.id GROUP BY users.id HAVING total_spent > 50;
SELECT email FROM users WHERE email LIKE '%@example.com';
SELECT products.name, SUM(orders.quantity) AS total_sold FROM products LEFT JOIN orders ON products.id = orders.product_id GROUP BY products.id ORDER BY total_sold DESC;