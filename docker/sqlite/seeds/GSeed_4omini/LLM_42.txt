PRAGMA foreign_keys=ON;
CREATE TABLE users(id INTEGER PRIMARY KEY, name TEXT NOT NULL, email TEXT UNIQUE NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE posts(id INTEGER PRIMARY KEY, user_id INTEGER, title TEXT NOT NULL, body TEXT, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE CASCADE);
CREATE TABLE comments(id INTEGER PRIMARY KEY, post_id INTEGER, user_id INTEGER, content TEXT NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, 
FOREIGN KEY(post_id) REFERENCES posts(id) ON DELETE CASCADE, 
FOREIGN KEY(user_id) REFERENCES users(id) ON DELETE SET NULL);

WITH RECURSIVE user_ids(i) AS (VALUES(1) UNION ALL SELECT i+1 FROM user_ids WHERE i < 50) 
INSERT INTO users(name, email) SELECT 
    'User ' || i, 
    'user' || i || '@example.com' 
FROM user_ids;

WITH RECURSIVE post_ids(j) AS (VALUES(1) UNION ALL SELECT j+1 FROM post_ids WHERE j < 100) 
INSERT INTO posts(user_id, title, body) SELECT 
    (ABS(RANDOM() % 50) + 1), 
    'Post Title ' || j, 
    'This is the content of post number ' || j 
FROM post_ids;

WITH RECURSIVE comment_ids(k) AS (VALUES(1) UNION ALL SELECT k+1 FROM comment_ids WHERE k < 200) 
INSERT INTO comments(post_id, user_id, content) SELECT 
    (ABS(RANDOM() % 100) + 1), 
    (ABS(RANDOM() % 50) + 1), 
    'Comment content for comment number ' || k 
FROM comment_ids;

UPDATE posts SET body = 'Updated body content' WHERE id = (SELECT MAX(id) FROM posts);
DELETE FROM comments WHERE content LIKE '%content for comment number 10%';
SELECT users.name, COUNT(posts.id) AS post_count FROM users LEFT JOIN posts ON users.id = posts.user_id GROUP BY users.id ORDER BY post_count DESC;
PRAGMA integrity_check;
SELECT * FROM users;
SELECT * FROM posts;
SELECT * FROM comments;