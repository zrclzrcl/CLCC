CREATE TABLE users(id INTEGER PRIMARY KEY, username TEXT NOT NULL, email TEXT UNIQUE NOT NULL);
CREATE TABLE posts(id INTEGER PRIMARY KEY, user_id INTEGER, content TEXT, FOREIGN KEY(user_id) REFERENCES users(id));
INSERT INTO users (username, email) VALUES ('john_doe', 'john@example.com');
INSERT INTO users (username, email) VALUES ('jane_doe', 'jane@example.com');
INSERT INTO posts (user_id, content) VALUES (1, 'This is the first post by John.');
INSERT INTO posts (user_id, content) VALUES (2, 'This is the first post by Jane.');
INSERT INTO posts (user_id, content) VALUES (1, 'John again.');
INSERT INTO users (username, email) VALUES ('duplicate_user', 'john@example.com'); -- should fail due to UNIQUE constraint
SELECT username, COUNT(posts.id) AS post_count FROM users LEFT JOIN posts ON users.id = posts.user_id GROUP BY users.id;
SELECT username FROM users WHERE username LIKE 'j%'; -- should retrieve usernames starting with 'j'
SELECT *, (SELECT COUNT(*) FROM posts WHERE user_id = users.id) AS total_posts FROM users ORDER BY total_posts DESC;
UPDATE users SET email = 'john_doe_updated@example.com' WHERE id = 1;
DELETE FROM posts WHERE id = (SELECT id FROM posts WHERE user_id = 1 ORDER BY RANDOM() LIMIT 1); -- delete a random post by John
SELECT username, CASE WHEN EXISTS(SELECT 1 FROM posts WHERE user_id = users.id) THEN 'Active' ELSE 'Inactive' END AS status FROM users;