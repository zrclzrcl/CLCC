PRAGMA foreign_keys = ON;
CREATE TABLE users(id INTEGER PRIMARY KEY, username TEXT NOT NULL UNIQUE, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE posts(id INTEGER PRIMARY KEY, user_id INTEGER NOT NULL, content TEXT NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE);
CREATE TRIGGER log_user_creation AFTER INSERT ON users BEGIN INSERT INTO audit_log(action, target_table, target_id, created_at) VALUES ('INSERT', 'users', NEW.id, CURRENT_TIMESTAMP); END;
INSERT INTO users(username) VALUES ('test_user1'), ('test_user2');
INSERT INTO posts(user_id, content) VALUES (1, 'This is a test post.'), (1, 'Another post for testing.'), (2, 'Hello from test_user2');
UPDATE posts SET content = 'Updated content' WHERE id = 1;

DELETE FROM posts WHERE id = (SELECT id FROM posts WHERE user_id = 1 ORDER BY created_at ASC LIMIT 1);
CREATE UNIQUE INDEX idx_username ON users(username);
SELECT * FROM users WHERE EXISTS (SELECT 1 FROM posts WHERE posts.user_id = users.id);