PRAGMA foreign_keys=ON;
CREATE TABLE users(id INTEGER PRIMARY KEY, username TEXT UNIQUE, email TEXT);
CREATE TABLE posts(id INTEGER PRIMARY KEY, user_id INTEGER, content TEXT, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY(user_id) REFERENCES users(id));
CREATE TABLE comments(id INTEGER PRIMARY KEY, post_id INTEGER, user_id INTEGER, comment TEXT, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY(post_id) REFERENCES posts(id), FOREIGN KEY(user_id) REFERENCES users(id));
INSERT INTO users(username, email) VALUES ('alice', 'alice@example.com'), ('bob', 'bob@example.com');
INSERT INTO posts(user_id, content) VALUES (1, 'Hello World!'), (1, 'SQLite is fantastic!'), (2, 'Fuzz testing is important.');
WITH RECURSIVE seq(n) AS (VALUES(1) UNION ALL SELECT n+1 FROM seq WHERE n<10) INSERT INTO comments(post_id, user_id, comment) SELECT (n % 3) + 1, (n % 2) + 1, 'Comment number ' || n FROM seq;
SELECT u.username, p.content, c.comment FROM users u JOIN posts p ON u.id = p.user_id LEFT JOIN comments c ON p.id = c.post_id ORDER BY p.created_at DESC, c.created_at;
UPDATE users SET email = 'alice_new@example.com' WHERE username = 'alice';
DELETE FROM comments WHERE created_at < datetime('now', '-1 day');
CREATE INDEX idx_user_posts ON posts(user_id);
CREATE INDEX idx_post_comments ON comments(post_id);