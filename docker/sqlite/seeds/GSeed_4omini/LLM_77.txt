CREATE TABLE users(id INTEGER PRIMARY KEY, username TEXT UNIQUE, email TEXT, created_at DATETIME DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE orders(order_id INTEGER PRIMARY KEY, user_id INTEGER, total_amount REAL, order_date DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY(user_id) REFERENCES users(id));
CREATE INDEX idx_username ON users(username);
CREATE VIEW user_orders AS SELECT u.username, SUM(o.total_amount) as total_spent FROM users u LEFT JOIN orders o ON u.id = o.user_id GROUP BY u.username;
INSERT INTO users(username, email) VALUES('test_user', 'test@example.com'), ('another_user', 'another@example.com');
INSERT INTO orders(user_id, total_amount) VALUES(1, 25.50), (1, 15.75), (2, 40.00);
SELECT u.username, o.total_amount, CASE WHEN o.total_amount > 20 THEN 'High' ELSE 'Low' END as spending_category FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE u.created_at >= '2023-01-01' ORDER BY total_amount DESC;
SELECT COUNT(*) FROM orders WHERE user_id = (SELECT id FROM users WHERE username = 'test_user') AND order_date BETWEEN '2023-01-01' AND '2023-12-31';