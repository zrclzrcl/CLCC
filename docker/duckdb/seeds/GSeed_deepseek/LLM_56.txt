-- Create tables with different data types
CREATE TABLE t1(
    id INT,
    name TEXT,
    value REAL,
    data BLOB
);

CREATE TABLE t2(
    id INT,
    ref_id INT,
    details TEXT
);

-- Insert data including edge cases
INSERT INTO t1 VALUES(1, 'Alice', 100.5, X'DEADBEEF');
INSERT INTO t1 VALUES(2, NULL, -999.9, NULL);
INSERT INTO t1 VALUES(3, '', 0.0, X'CAFE');

-- Alter table to add a new column
ALTER TABLE t1 ADD COLUMN status TEXT;

-- Update and delete operations
UPDATE t1 SET status = 'active' WHERE id = 1;
DELETE FROM t1 WHERE id = 2;

-- Insert data into the second table
INSERT INTO t2 VALUES(1, 1, 'Details for Alice');
INSERT INTO t2 VALUES(2, NULL, 'No reference');

-- Create indexes on different columns
CREATE INDEX idx_t1_id ON t1(id);
CREATE INDEX idx_t2_ref_id ON t2(ref_id);

-- SELECT queries with various clauses and functions

-- Simple join
SELECT t1.id, t2.details FROM t1 JOIN t2 ON t1.id = t2.ref_id;

-- Subquery
SELECT * FROM t1 WHERE id IN (SELECT ref_id FROM t2);

-- Window function
SELECT id, RANK() OVER (ORDER BY value DESC) AS rank FROM t1;

-- CTE
WITH active_users AS (
    SELECT id, name FROM t1 WHERE status = 'active'
)
SELECT au.id, t2.details 
FROM active_users au JOIN t2 ON au.id = t2.ref_id;

-- Aggregate functions with GROUP BY and HAVING
SELECT ref_id, COUNT(*) as count FROM t2 GROUP BY ref_id HAVING COUNT(*) > 0;

-- UNION
(SELECT id FROM t1) UNION (SELECT ref_id FROM t2);

-- INTERSECT
(SELECT id FROM t1 WHERE status = 'active') INTERSECT (SELECT ref_id FROM t2);

-- Transaction operations
BEGIN;
INSERT INTO t1 VALUES(4, 'Bob', 200.0, X'F00D');
COMMIT;

-- Test rollback
BEGIN;
INSERT INTO t1 VALUES(5, 'Charlie', 300.0, X'DEAD');
ROLLBACK;

-- Cleanup (optional)
DROP TABLE t1;
DROP TABLE t2;