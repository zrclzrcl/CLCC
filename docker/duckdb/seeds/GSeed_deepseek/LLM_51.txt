CREATE TABLE test_table (
    id INTEGER PRIMARY KEY,
    name VARCHAR(50),
    is_active BOOLEAN,
    last_updated TIMESTAMP,
    balance NUMERIC
);

INSERT INTO test_table (id, name, is_active, last_updated, balance)
VALUES 
(1, 'Alice', TRUE, '2023-10-01 12:00:00', 1000.5),
(2, 'Bob', FALSE, '2023-10-02 14:30:00', NULL),
(3, 'Charlie', TRUE, '2023-10-03 09:15:00', -500.75);

SELECT 
    id,
    name,
    RANK() OVER (ORDER BY balance DESC) AS rank_by_balance,
    ROW_NUMBER() OVER (PARTITION BY is_active ORDER BY last_updated) AS row_num
FROM test_table;

WITH summary_stats AS (
    SELECT 
        is_active,
        COUNT(*) AS total_count,
        AVG(balance) AS avg_balance
    FROM test_table
    GROUP BY is_active
)
SELECT * FROM summary_stats;

CREATE INDEX idx_last_updated ON test_table (last_updated);