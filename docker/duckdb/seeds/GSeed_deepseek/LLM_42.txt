PRAGMA memory_limit='1GB';
CREATE TABLE t1(
    id INTEGER PRIMARY KEY,
    name VARCHAR(255),
    data BLOB,
    ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
WITH RECURSIVE cte(i) AS (
    SELECT 1 UNION ALL SELECT i+1 FROM cte WHERE i < 100
)
INSERT INTO t1(id, name, data) 
SELECT i, 'test_' || i::VARCHAR, randomblob(1024) FROM cte;
CREATE TABLE t2(
    id INTEGER,
    value DECIMAL(10,2),
    FOREIGN KEY(id) REFERENCES t1(id)
);
INSERT INTO t2
SELECT id, (random() * 100)::DECIMAL(10,2) FROM t1;
UPDATE t1 SET name = 'updated_' || name WHERE id % 2 = 0;
DELETE FROM t2 WHERE value < 50.0;
SELECT 
    t1.id,
    t1.name,
    t2.value,
    ROW_NUMBER() OVER (ORDER BY t1.ts) AS rn
FROM t1
JOIN t2 ON t1.id = t2.id
WHERE t1.data IS NOT NULL
ORDER BY t1.ts DESC;
PRAGMA integrity_check;