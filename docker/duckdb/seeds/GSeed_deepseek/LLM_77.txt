-- Create a table with various data types to test different scenarios
CREATE TABLE t1 (
    id INTEGER PRIMARY KEY,
    name VARCHAR(50),
    price DECIMAL(10, 2),
    created_at TIMESTAMP,
    status BOOLEAN
);

-- Insert sample data into the table
INSERT INTO t1 VALUES 
    (1, 'Product A', 99.99, '2023-01-01 00:00:00', true),
    (2, 'Product B', 149.99, '2023-01-02 00:00:00', false),
    (3, 'Product C', 199.99, '2023-01-03 00:00:00', true);

-- Create a view with a complex expression and window function
CREATE VIEW v1 AS 
    WITH cte AS (
        SELECT id, name, price,
            ROW_NUMBER() OVER (ORDER BY price DESC) as rank
        FROM t1
    )
    SELECT 
        id, 
        name, 
        price, 
        rank,
        SUM(price) OVER (ORDER BY rank) as running_total
    FROM cte;

-- Create a table with unique constraints and indexes for testing
CREATE TABLE t2 (
    x VARCHAR(50) UNIQUE,
    y INTEGER NOT NULL,
    z DECIMAL CHECK (z > 0)
);

-- Insert data into the second table
INSERT INTO t2 VALUES 
    ('A', 1, 100.5),
    ('B', 2, 200.3),
    ('C', 3, 300.7);

-- Create an index on a column for testing query performance
CREATE INDEX idx_t2_y ON t2(y);

-- Select statement with various operations and joins
SELECT 
    t1.id,
    t1.name,
    t1.price * 1.05 as price_with_tax,
    v1.rank,
    v1.running_total,
    t2.y,
    t2.z,
    CASE 
        WHEN t1.status THEN 'Active'
        ELSE 'Inactive'
    END as status_desc
FROM t1
LEFT JOIN v1 ON t1.id = v1.id
RIGHT JOIN t2 ON t1.name = t2.x
WHERE t1.created_at >= '2023-01-01 00:00:00';