CREATE TABLE t1(a INTEGER PRIMARY KEY, b TEXT, c REAL, d BOOLEAN);
INSERT INTO t1 VALUES (1, 'test', 3.14, TRUE), (2, NULL, NULL, FALSE);
CREATE TABLE log(id INTEGER PRIMARY KEY, a INTEGER, b TEXT, timestamp TIMESTAMP);
CREATE TRIGGER tr1 AFTER UPDATE ON t1 BEGIN INSERT INTO log(a, b, timestamp) VALUES(OLD.a, OLD.b, CURRENT_TIMESTAMP); END;
WITH cte AS (SELECT * FROM t1 WHERE d = TRUE) SELECT ROW_NUMBER() OVER (ORDER BY a) as rn, * FROM cte;