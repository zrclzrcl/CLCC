-- Create tables with various data types
CREATE TABLE t1(id INT PRIMARY KEY, num_int INT, num_float FLOAT);
CREATE TABLE t2(id INT PRIMARY KEY, text TEXT, length INT);
CREATE TABLE t3(id INT PRIMARY KEY, dt DATE, ts TIMESTAMP);

-- Insert sample data including NULLs for edge cases
INSERT INTO t1 VALUES(1, 100, 50.5), (2, NULL, NULL), (3, 200, 75.3);
INSERT INTO t2 VALUES(1, 'apple', 5), (2, 'banana', 6), (3, 'cherry', 6);
INSERT INTO t3 VALUES(1, '2023-01-01', '2023-01-01 12:00:00'), (2, '2023-02-02', NULL), (3, NULL, '2023-03-03 15:30:00');

-- Join t1 and t2 with a WHERE clause and ORDER BY
SELECT t1.id, t1.num_int, t2.text 
FROM t1 
JOIN t2 ON t1.id = t2.id 
WHERE t1.num_int > 50 
ORDER BY t2.length DESC;

-- Left join with GROUP BY and HAVING
SELECT t1.id, t3.dt, COUNT(*) AS cnt 
FROM t1 
LEFT JOIN t3 ON t1.id = t3.id 
GROUP BY t1.id, t3.dt 
HAVING cnt >= 1;

-- Use a CTE to filter and modify data
WITH cte AS (
    SELECT id, num_int 
    FROM t1 
    WHERE num_int IS NOT NULL
)
SELECT id, num_int * 2 AS doubled_num 
FROM cte 
ORDER BY doubled_num DESC;

-- Apply window function for row numbering
SELECT id, num_float, ROW_NUMBER() OVER(ORDER BY num_float DESC) AS rn 
FROM t1 
WHERE num_float IS NOT NULL;