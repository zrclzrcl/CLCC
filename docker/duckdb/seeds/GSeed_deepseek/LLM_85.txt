DROP TABLE IF EXISTS t1;
DROP TABLE IF EXISTS t2;

CREATE TABLE t1 (
    id INTEGER,
    name VARCHAR(50),
    value DECIMAL(10, 2),
    created_at TIMESTAMP,
    status BOOLEAN,
    category CHAR(1)
);

WITH RECURSIVE numbers(x) AS (
    SELECT 1
    UNION ALL
    SELECT x + 1 FROM numbers WHERE x < 1000
)
INSERT INTO t1 (id, name, value, created_at, status, category)
SELECT 
    x,
    'Item' || x,
    x * 10.5 + (random() * 100),
    CURRENT_TIMESTAMP - INTERVAL '1 day' * x,
    (x % 2) = 0,
    CASE WHEN x % 3 = 0 THEN 'A' ELSE 'B' END
FROM numbers;

CREATE TABLE t2 AS
SELECT 
    category,
    status,
    COUNT(*) as cnt,
    SUM(value) as total_value,
    ROW_NUMBER() OVER (ORDER BY category, status) as row_num
FROM t1
GROUP BY category, status;

SELECT DISTINCT ON (t1.category)
    t1.id,
    t1.name,
    t2.cnt,
    t2.total_value
FROM t1
JOIN t2 ON t1.category = t2.category AND t1.status = t2.status
ORDER BY t1.category, t1.id DESC;

SELECT 
    category,
    status,
    cnt,
    total_value,
    RANK() OVER (PARTITION BY category ORDER BY total_value DESC) as rank
FROM t2;

SELECT 
    name,
    value,
    created_at,
    status,
    CASE 
        WHEN value > 1000 THEN 'High'
        WHEN value > 500 THEN 'Medium'
        ELSE 'Low'
    END as value_category
FROM t1
WHERE status = true
ORDER BY value DESC;

SELECT 
    category,
    COUNT(*) as total_items,
    SUM(value) as sum_value,
    AVG(value) as avg_value
FROM t1
GROUP BY category
HAVING COUNT(*) > 50;

SELECT 
    id,
    name,
    created_at,
    EXTRACT(DAY FROM created_at) as day_of_month,
    EXTRACT(MONTH FROM created_at) as month,
    EXTRACT(YEAR FROM created_at) as year
FROM t1
WHERE status = false;