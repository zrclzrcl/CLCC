-- Create tables with various data types and constraints
CREATE TABLE t1 (
    id INT PRIMARY KEY,
    num INT,
    str TEXT,
    UNIQUE (num),
    CHECK (str IS NOT NULL)
);

-- Table with generated column using window function
CREATE TABLE t2 AS 
SELECT 
    id, 
    num, 
    ROW_NUMBER() OVER (ORDER BY id) AS rn 
FROM t1;

-- Insert sample data
INSERT INTO t1 VALUES
(0, 0, 'a'),
(1, NULL, 'b'),
(2, -999999, 'c'),
(3, 42, NULL),
(4, 999999, 'e');

-- Update statement to modify data
UPDATE t1 SET num = id WHERE id > 2;

-- Create table with complex constraints and indexes
CREATE TABLE t3 (
    a INT,
    b TEXT,
    c DECIMAL,
    d TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (a, b),
    CHECK (c IS NOT NULL)
);

-- Insert data into t3 with expressions
INSERT INTO t3 
SELECT 
    id * 2 AS a, 
    str || 'x' AS b, 
    num / 100.0 AS c 
FROM t1;

-- Create CTAS with window functions and joins
CREATE TABLE t4 AS
WITH cte AS (
    SELECT 
        t1.id,
        t1.num,
        t2.rn,
        SUM(t1.num) OVER (ORDER BY t1.id) AS running_total
    FROM t1
    JOIN t2 ON t1.id = t2.id
)
SELECT 
    id, 
    num, 
    rn, 
    running_total 
FROM cte;

-- Select statements with various clauses
SELECT 
    id, 
    str || ' world' AS greeting,
    num * 2 AS doubled_num
FROM t1
WHERE num > 0
ORDER BY id DESC
LIMIT 2;

SELECT 
    a, 
    b, 
    ROUND(c, 2) AS rounded_c
FROM t3
WHERE d >= CURRENT_TIMESTAMP - INTERVAL '1 day'
GROUP BY a, b, c
HAVING COUNT(*) > 1
ORDER BY a ASC;

-- Update with join and condition
UPDATE t1 SET str = 'updated' WHERE id IN (SELECT id FROM t2 WHERE rn < 3);