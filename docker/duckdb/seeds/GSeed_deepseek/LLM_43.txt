PRAGMA cache_size=1024;
CREATE TABLE t1(
    id INT PRIMARY KEY,
    name TEXT,
    data BLOB,
    value DECIMAL(10, 2),
    timestamp TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
WITH RECURSIVE cte(x) AS (
    SELECT 1 UNION ALL SELECT x + 1 FROM cte WHERE x < 100
)
INSERT INTO t1(id, name, data, value) 
SELECT x, 'test' || x, zeroblob(100), RAND() * 1000.56 FROM cte;
UPDATE t1 SET data = zeroblob(2048) WHERE id % 3 = 0;
CREATE TABLE t2(
    id INT,
    category TEXT CHECK (category IN ('A', 'B', 'C')),
    FOREIGN KEY(id) REFERENCES t1(id)
);
INSERT INTO t2(id, category) VALUES
    (1, 'A'), (2, 'B'), (3, 'C'),
    (4, 'A'), (5, 'B'), (6, 'C');
SELECT 
    t1.id,
    t1.name,
    t2.category,
    SUM(t1.value) OVER (PARTITION BY t2.category) AS category_sum
FROM t1
JOIN t2 ON t1.id = t2.id
WHERE t1.timestamp >= CURRENT_TIMESTAMP - INTERVAL '1 day'
ORDER BY t1.id DESC;
SELECT 
    id,
    name,
    value,
    RANK() OVER () AS rank
FROM t1
WHERE data IS NOT NULL
LIMIT 10 OFFSET 5;