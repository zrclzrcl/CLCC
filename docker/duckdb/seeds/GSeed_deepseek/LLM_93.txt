DROP TABLE IF EXISTS t1;
DROP TABLE IF EXISTS t2;
CREATE TABLE t1(
    id INTEGER PRIMARY KEY,
    name VARCHAR(50),
    age INTEGER,
    score DECIMAL(5, 2),
    created_at TIMESTAMP
);
INSERT INTO t1 VALUES
    (1, 'Alice', 30, 98.7, '2023-01-01 12:00:00'),
    (2, 'Bob', 25, NULL, '2023-01-02 14:30:00'),
    (3, 'Charlie', 35, 87.6, '2023-01-03 09:15:00');
CREATE TABLE t2(
    id INTEGER PRIMARY KEY,
    category_id INTEGER,
    amount DECIMAL(10, 2)
);
INSERT INTO t2 VALUES
    (1, 1, 100.5),
    (2, NULL, 200.3),
    (3, 2, 150.7);
CREATE VIEW v1 AS
SELECT 
    id,
    name,
    age,
    score,
    created_at
FROM t1;
WITH cte AS (
    SELECT 
        t1.id,
        t1.name,
        t2.category_id,
        t2.amount
    FROM t1
    LEFT JOIN t2 ON t1.id = t2.id
)
SELECT 
    id,
    name,
    category_id,
    amount,
    ROW_NUMBER() OVER (ORDER BY id) AS row_num,
    RANK() OVER (PARTITION BY category_id ORDER BY amount DESC) AS rank_desc,
    CASE 
        WHEN age > 30 THEN 'Senior'
        ELSE 'Junior'
    END AS age_group
FROM cte;