-- Create a table with various data types
CREATE TABLE test_table (
    id INTEGER,
    name VARCHAR(50),
    price DECIMAL(10, 2),
    created_at TIMESTAMP,
    is_active BOOLEAN
);

-- Insert sample data
INSERT INTO test_table VALUES 
(1, 'Product 1', 10.99, '2023-01-01 00:00:00', true),
(2, 'Product 2', 15.99, '2023-01-02 00:00:00', false),
(3, 'Product 3', 20.99, '2023-01-03 00:00:00', true);

-- Create a table for sales data
CREATE TABLE sales (
    sale_id INTEGER,
    product_id INTEGER,
    quantity INTEGER,
    sale_date DATE
);

-- Insert sample sales data
INSERT INTO sales VALUES 
(1, 1, 5, '2023-01-01'),
(2, 1, 3, '2023-01-02'),
(3, 2, 2, '2023-01-01'),
(4, 3, 1, '2023-01-03');

-- Create a recursive CTE to generate numbers
WITH RECURSIVE numbers AS (
    SELECT 1 as n
    UNION ALL
    SELECT n + 1 FROM numbers WHERE n < 5
)
SELECT * FROM numbers;

-- Query with window functions and joins
WITH sales_summary AS (
    SELECT 
        product_id, 
        SUM(quantity) as total_quantity,
        COUNT(*) as sale_count
    FROM sales
    GROUP BY product_id
)
SELECT 
    t.name,
    ss.total_quantity,
    ss.sale_count,
    ROW_NUMBER() OVER (ORDER BY ss.total_quantity DESC) as rank
FROM sales_summary ss
JOIN test_table t ON ss.product_id = t.id
ORDER BY ss.total_quantity DESC;