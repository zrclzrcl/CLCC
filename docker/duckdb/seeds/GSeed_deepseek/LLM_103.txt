-- Create tables with various data types
CREATE TABLE test_table (
    id INT,
    name VARCHAR(100),
    value DECIMAL(10, 2),
    created_at TIMESTAMP,
    status BOOLEAN
);

-- Insert sample data into the table
INSERT INTO test_table VALUES
    (1, 'Alice', 100.5, '2023-01-01 00:00:00', TRUE),
    (2, 'Bob', 200.75, '2023-01-02 01:00:00', FALSE),
    (3, 'Charlie', 300.99, '2023-01-03 02:00:00', TRUE);

-- Create an index on the id column
CREATE INDEX idx_test_table_id ON test_table(id);

-- Create a view that joins test_table with itself
CREATE VIEW test_view AS
SELECT t1.id as id1, t2.id as id2, t1.name, t2.value
FROM test_table t1
JOIN test_table t2 ON t1.id = t2.id;

-- Create a materialized view for testing
CREATE MATERIALIZED VIEW mv_test AS
SELECT name, value, status
FROM test_table
WHERE status = TRUE;

-- Common table expression (CTE) example
WITH cte_example AS (
    SELECT id, name, value,
           ROW_NUMBER() OVER (ORDER BY value DESC) as row_num
    FROM test_table
)
SELECT * FROM cte_example
WHERE row_num <= 5;

-- Complex query with window functions and joins
SELECT 
    t1.name,
    t2.value,
    SUM(t1.value) OVER (PARTITION BY t1.status) as sum_value,
    RANK() OVER (ORDER BY t1.value DESC) as rank_value
FROM test_table t1
JOIN test_view tv ON t1.id = tv.id1
LEFT JOIN test_table t2 ON tv.id2 = t2.id
GROUP BY t1.name, t2.value
HAVING SUM(t1.value) > 150.0;

-- Test edge cases with NULL values and empty results
SELECT * FROM test_table WHERE name IS NULL;
SELECT * FROM test_view WHERE id1 NOT IN (SELECT id FROM test_table);

-- Recursive CTE example
WITH RECURSIVE rec_cte AS (
    SELECT 1 as n
    UNION ALL
    SELECT n + 1 FROM rec_cte WHERE n < 5
)
SELECT * FROM rec_cte;

-- Test boundary conditions for numeric types
SELECT 
    CAST(9223372036854775807 AS BIGINT) as max_bigint,
    CAST(-9223372036854775808 AS BIGINT) as min_bigint;